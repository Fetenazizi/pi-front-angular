<div class="admin-container">
  <h2>Gestion des Produits</h2>

  <!-- Indicateur de chargement -->
  <div *ngIf="isLoading" class="loading-indicator">
    <div class="spinner"></div>
    <span>Chargement en cours...</span>
  </div>

  <!-- Formulaire d'ajout/modification -->
  <div *ngIf="selectedProduct" class="edit-form">
    <h3>{{ isEditing ? 'Modifier' : 'Ajouter' }} un produit</h3>

    <div class="form-group">
      <label for="productName">Nom:</label>
      <input
        id="productName"
        [(ngModel)]="selectedProduct.name"
        name="productName"
        placeholder="Nom du produit"
        required
        [disabled]="isLoading"
      />
    </div>

    <div class="form-group">
      <label for="category">CatÃ©gorie:</label>
      <input
        id="category"
        [(ngModel)]="selectedProduct.category"
        name="category"
        placeholder="CatÃ©gorie du produit"
        required
        [disabled]="isLoading"
      />
    </div>

    <div class="form-group">
      <label for="productDescription">Description:</label>
      <textarea
        id="productDescription"
        [(ngModel)]="selectedProduct.description"
        name="productDescription"
        placeholder="Description"
        required
        [disabled]="isLoading"
      ></textarea>
    </div>

    <div class="form-group">
      <label for="productPrice">Prix (DT):</label>
      <input
        id="productPrice"
        type="number"
        [(ngModel)]="selectedProduct.price"
        name="productPrice"
        placeholder="Prix"
        min="0"
        step="0.01"
        required
        [disabled]="isLoading"
      />
    </div>

    <div class="form-group">
      <label for="productStockQuantity">QuantitÃ© Disponible:</label>
      <input
        id="productStockQuantity"
        type="number"
        [(ngModel)]="selectedProduct.stockQuantity"
        name="productStockQuantity"
        placeholder="QuantitÃ© disponible"
        min="0"
        required
        [disabled]="isLoading"
      />
    </div>

    <div class="form-group">
      <label for="productImage">Image du produit:</label>
      <input
        id="productImage"
        type="file"
        (change)="onImageSelected($event)"
        [disabled]="isLoading"
        accept="image/*"
      />
      <button class="camera-button" type="button" (click)="startCamera()" *ngIf="!showCameraPreview">ðŸ“· Prendre une photo</button>
    </div>

    <!-- AperÃ§u de la camÃ©ra -->
    <div *ngIf="showCameraPreview" class="camera-container">
      <video id="camera-preview" autoplay></video>
      <button type="button" (click)="capturePhoto()">ðŸ“¸ Capturer</button>
    </div>

    <!-- AperÃ§u de l'image -->
    <div *ngIf="imagePreview" class="image-preview">
      <img [src]="imagePreview" alt="AperÃ§u de l'image" />
    </div>

    <div class="form-actions">
      <button
        (click)="saveProduct()"
        [disabled]="isLoading || !selectedProduct.name || !selectedProduct.description || !selectedProduct.price || selectedProduct.stockQuantity === 0"
        class="save-button"
      >
        {{ isLoading ? 'Enregistrement...' : 'Enregistrer' }}
      </button>
      <button
        (click)="cancelEdit()"
        [disabled]="isLoading"
        class="cancel-button"
      >
        Annuler
      </button>
      <!-- Nouveau bouton pour revenir Ã  la liste -->
      <button
        type="button"
        (click)="cancelEdit()"
        [disabled]="isLoading"
        class="return-button"
      >
        Retour Ã  la liste
      </button>
    </div>
  </div>

  <!-- Bouton pour ajouter un produit et liste des produits affichÃ©s quand aucun produit n'est sÃ©lectionnÃ© -->
  <div *ngIf="!selectedProduct && !isLoading">
    <!-- Bouton d'ajout -->
    <div class="add-product-container">
      <button (click)="startAdd()" class="add-button">
        <i class="fas fa-plus"></i> Ajouter un produit
      </button>
    </div>

    <!-- Liste des produits -->
    <div class="product-list">
      <div *ngFor="let product of products" class="product-item">
        <div class="product-info">
          <h3>{{ product.name }}</h3>
          <p class="description">{{ product.description }}</p>
          <p class="price">{{ product.price }} DT</p>
          <p class="stock">QuantitÃ© disponible: {{ product.stockQuantity }}</p>
        </div>

        <div class="product-image" *ngIf="product.imageUrl">
          <img [src]="product.imageUrl" alt="{{ product.name }}" />
        </div>

        <div class="product-actions">
          <button (click)="startEdit(product)" [disabled]="isLoading">Modifier</button>
          <button (click)="deleteProduct(product.idProduct)" [disabled]="isLoading">Supprimer</button>
        </div>
      </div>
    </div>
  </div>
</div>
